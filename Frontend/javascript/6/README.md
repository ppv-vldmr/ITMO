# Задача «Путешествие Аркадия»

> Мы очень хотим, чтобы код вы написали сами, а не пользовались внешними библиотеками.

## Основное задание

Свадьба Аркадия сыграна, торт съеден, гости проводили молодоженов в их новую семейную жизнь. Что же дальше?
А дальше наша молодая пара планирует свое свадебное путешествие. Прагматичный Аркадий посчитал важным
заранее продумать свадебное путешествие, чтобы оно было максимально комфортным.

Аркадий едет в свадебное путешествие не только со своей возлюбленной супругой, но и с личным фотографом, поэтому
перед нашим программистом-прагматиком стоит не менее прагматичная задача: составить расписание маршрута так, чтобы
можно было сделать фотографии с разными погодными условиями в разных городах.

Для того чтобы достичь желаемого, Аркадий решил написать приложение, которое не уступит по своей красоте, простоте
и удобству даже Кибертраку Илона Маска. Аркадий слышал, что у Яндекс.Погоды есть удобное API для получения прогноза
погоды. Им он и решил воспользоваться в своем приложении.

Аркадию, как известному эстету, хотелось сделать свою библиотеку простой и удобной:

```javascript
const availableGeoIds = [5, 10, 192, 20, 37];

const sunnyPlan = planTrip(availableGeoIds)
  .sunny(2)
  .cloudy(1)
  .sunny(2)
  .max(3)
  .build();

const cloudyPlan = planTrip(availableGeoIds)
  .cloudy(2)
  .sunny(1)
  .build();
```

Можно считать, что все города, которые будут передаваться в метод `planTrip`, расположены между собой на расстоянии,
которое Аркадий может преодолеть меньше, чем за половину суток, поэтому про расстояния в рамках данного задания можно забыть.
Путешествие начинает свой отсчёт с одного из городов из списка.

## Методы-условия

Методы `cloudy`, `sunny`, `max` добавляют условия для будущего путешествия.
Они принимают параметр — число дней, в течении которого должно соблюдаться заданное методом условие.

- **sunny(N)** — Солнечная погода N дней. Для API Яндекс.Погоды — это значения `condition` равные `clear` и `partly-cloud`
- **cloudy(N)** — Полная облачность N дней. Для API Яндекс.Погоды — это значения `condition` равные `cloudy` и `overcast`
- **max(M)** — Максимальное количество дней, в котором молодожены хотят быть в одном городе

Для соблюдения условий Аркадий может переместиться в другой город или же остаться в предыдущем городе путешествия.
Аркадий с женой очень любят изучать города, по которым путешествуют очень внимательно, поэтому строят маршрут так,
чтобы максимальное количество дней побыть в одном городе.

## API планировщика

Метод `build()` инициирует построение маршрута и возвращает `Promise` с ответом.

Если маршрут по указанным условиям сформировать возможно, то ответом будет массив вида `[ { geoid: 1, day: 1 } ]`,
где `day` – день поездки (начиная с 1):

Если по указанным условиям маршрут построить невозможно, метод `build()` возвращает `Promise`, который переходит в состояние `rejected`
с ошибкой и сообщением: `Не могу построить маршрут!`.

## Библиотека для HTTP запросов

В браузер уже встроена глобально доступная функция [`fetch`](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch) (она же `window.fetch`), которая позволяет удобно делать HTTP запросы.

Мы работаем в Node.js окружении и в неё встроены низкоуровневые модули `http`, `https`, `http2`.
Они гораздо менее удобные, чем `fetch`. Предлагаем вам в решении домашнего задания воспользоваться
библиотекой [`node-fetch`](https://github.com/bitinn/node-fetch), которая почти полностью повторяет браузерный аналог.
Мы уже установили её для вас.

## API Яндекс.Погоды

Для получения прогноза погода на ближайшие семь дней можно обратиться [к данному методу API](https://api.weather.yandex.ru/v2/forecast?geoid=10&hours=false&limit=7),
заменяя лишь параметр `geoid` на необходимый. За документацией ответа можно обратиться на [эту страницу](https://clck.ru/Kakwq).
Для обращения к API вам понадобится получить ключ для тарифа "Тестовый". Положите полученный ключ в файл `key.json`, чтобы не отправлять ваш секретный ключ вместе с решением.
Прогнозом на сутки для города следует считать прогноз в графе `day_short`.

## Дополнительные условия

- Запрос к серверу по каждому из городов не должен происходить более одного раза;
- Путешествие должно начинаться со дня выполнения запроса на построение маршрута;
- Порядок погодных условий нужно иметь в виду;
- Посетив город один раз — молодожены уже не захотят туда возвращаться;
- Обратите внимание, что на пути у наших молодожёнов не должно быть осадков! То есть погода может быть только `clear`, `partly-cloudy`, `cloudy` и `overcast`.

## Доступные команды

Перед началом работы выполните команду `npm install` для установки зависимостей.

Запускаются так: `npm run <command>`

| Команда       | Действие                                |
| ------------- | --------------------------------------- |
| start         | Запуск src/index.js                     |
| test          | Запуск всех тестов                      |

## Отправка решения
При отправке решения отправляйте **только** файл `weather.js` или его содержимое

## Полезные ссылки

- [Цепочка вызовов](https://medium.com/backticks-tildes/understanding-method-chaining-in-javascript-647a9004bd4f)
- [Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/reference/Global_Objects/Promise)
- [Async/Await](https://learn.javascript.ru/async-await)

<img
    src="https://yastatic.net/s3/lyceum/ifmo-homeworks/weather.jpg" 
    width="1024"
    height="637"
    alt="Weather's meatballs"
/>
